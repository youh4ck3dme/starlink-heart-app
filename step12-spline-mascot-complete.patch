From 1087189eb7c63ed668e963b621c7b48c98a621aa Mon Sep 17 00:00:00 2001
From: youh4ck3dme <h4ck3d@h4ck3d.me>
Date: Thu, 25 Dec 2025 05:00:43 +0100
Subject: [PATCH] feat: add premium 3D mascot support via Spline (Beta)

- Add Starry3D component wrapping @splinetool/react-spline
- Add settings toggle '3D Mascot (Beta)' to enable/disable
- Implement static image fallback if disabled or reduced motion
- Persist setting in localStorage (enable3DMascot)
- Add loading state spinner + error handling
- Update WelcomeScreen to use Starry3D instead of img
- Add '3d-mascot-setup.md' docs for pasting Spline URL
---
 docs/3d-mascot-setup.md                 |  8 +++
 package.json                            |  1 +
 src/components/StarlinkHeartApp.tsx     |  7 +++
 src/components/common/SettingsModal.tsx | 35 ++++++++++++
 src/components/mascot/Starry3D.tsx      | 75 +++++++++++++++++++++++++
 src/routes/WelcomeScreen.tsx            | 11 ++--
 6 files changed, 131 insertions(+), 6 deletions(-)
 create mode 100644 docs/3d-mascot-setup.md
 create mode 100644 src/components/mascot/Starry3D.tsx

diff --git a/docs/3d-mascot-setup.md b/docs/3d-mascot-setup.md
new file mode 100644
index 0000000..af9c798
--- /dev/null
+++ b/docs/3d-mascot-setup.md
@@ -0,0 +1,8 @@
+
+## Premium Feature: 3D Mascot
+To enable the 3D mascot:
+1. Create a scene in Spline (https://spline.design)
+2. Export as "Code" -> "React"
+3. Copy the scene URL (e.g., https://prod.spline.design/...)
+4. Paste it into `src/components/mascot/Starry3D.tsx` replacing `PASTE_YOUR_SPLINE_URL_HERE`
+5. Enable "3D Mascot (Beta)" in app settings
diff --git a/package.json b/package.json
index 8f5847d..72ab0d6 100755
--- a/package.json
+++ b/package.json
@@ -11,6 +11,7 @@
   },
   "dependencies": {
     "@google/genai": "^1.34.0",
+    "@splinetool/react-spline": "^4.1.0",
     "firebase": "^10.12.2",
     "react": "^18.3.1",
     "react-dom": "^18.3.1",
diff --git a/src/components/StarlinkHeartApp.tsx b/src/components/StarlinkHeartApp.tsx
index 2ff5e9c..30146f0 100755
--- a/src/components/StarlinkHeartApp.tsx
+++ b/src/components/StarlinkHeartApp.tsx
@@ -6,6 +6,7 @@ import { Heart } from '../types';
 import { generateCosmicResponse, getStarryTip, generateCosmicHint, generateParentGuide } from '../services/geminiService';
 import { hasParentConsent, setParentConsent, clearAllAppData } from '../services/consentService';
 import ParentNotice from './ParentNotice';
+import Starry3D from './mascot/Starry3D';
 
 // Define Avatars with Names
 const AVATAR_OPTIONS = [
@@ -176,6 +177,12 @@ const DashboardScreen = ({
                     <span className="text-2xl">{avatar}</span>
                     <span className={`font-bold ${textColor}`}>Kadet</span>
                  </div>
+                 
+                 {/* Compact Mascot */}
+                 <div className="w-12 h-12 rounded-full overflow-hidden border-2 border-white/40 shadow-[0_0_15px_rgba(255,255,255,0.3)] bg-gradient-to-b from-indigo-500/30 to-purple-600/30 backdrop-blur-md">
+                    <Starry3D className="w-full h-full" />
+                 </div>
+
                  <div className="flex items-center gap-1.5 bg-yellow-400/20 px-3 py-1.5 rounded-full border border-yellow-400/30">
                     <span className="text-xl">üíé</span>
                     <span className={`font-bold ${textColor === 'text-white' ? 'text-yellow-200' : 'text-yellow-700'}`}>{gems}</span>
diff --git a/src/components/common/SettingsModal.tsx b/src/components/common/SettingsModal.tsx
index 5f75b9e..b0ffdb6 100644
--- a/src/components/common/SettingsModal.tsx
+++ b/src/components/common/SettingsModal.tsx
@@ -11,6 +11,7 @@ interface SettingsModalProps {
   initialAvatar?: string;
   initialTheme?: string;
   initialApiKey?: string;
+  initial3DEnabled?: boolean;
 }
 
 const AVATARS = [
@@ -41,13 +42,21 @@ export default function SettingsModal({
   initialAvatar = "iskra",
   initialTheme = "light",
   initialApiKey = "",
+  initial3DEnabled = false,
 }: SettingsModalProps) {
   const [selectedAvatar, setSelectedAvatar] = useState(initialAvatar);
   const [theme, setTheme] = useState(initialTheme);
   const [apiKey, setApiKey] = useState(initialApiKey);
+  const [enable3D, setEnable3D] = useState(() => localStorage.getItem('enable3DMascot') === 'true');
 
   const handleSave = () => {
     onSave({ selectedAvatar, theme, apiKey });
+    // Save 3D setting directly to localStorage
+    localStorage.setItem('enable3DMascot', String(enable3D));
+    // Reload to apply changes cleanly if changed
+    if (localStorage.getItem('enable3DMascot') !== String(initial3DEnabled)) {
+      window.location.reload();
+    }
     onClose();
   };
 
@@ -197,6 +206,32 @@ export default function SettingsModal({
             </div>
           </section>
 
+          {/* SECTION: 3D MASCOT (BETA) */}
+          <section className="rounded-2xl border border-black/5 bg-gradient-to-r from-indigo-50 to-purple-50 p-4">
+            <div className="flex items-center justify-between">
+              <div>
+                <div className="text-xs font-bold tracking-widest text-indigo-900/60">3D MASKOT (BETA)</div>
+                <div className="text-sm font-semibold text-indigo-900 mt-1">Prof. StarLink v 3D</div>
+              </div>
+              
+              <button
+                onClick={() => setEnable3D(!enable3D)}
+                className={`relative w-12 h-7 rounded-full transition-colors duration-300 ${
+                  enable3D ? 'bg-indigo-600' : 'bg-black/10'
+                }`}
+              >
+                <div 
+                  className={`absolute top-1 left-1 w-5 h-5 rounded-full bg-white shadow-sm transition-transform duration-300 ${
+                    enable3D ? 'translate-x-5' : 'translate-x-0'
+                  }`} 
+                />
+              </button>
+            </div>
+            <div className="mt-2 text-xs text-indigo-900/50">
+              Viac efektov, m√¥≈æe viac ≈æra≈• bat√©riu. Vy≈æaduje re≈°tart apky.
+            </div>
+          </section>
+
           {/* SECTION: DANGER ZONE */}
           <section className="rounded-2xl border border-red-200 bg-red-50 p-4">
             <div className="text-xs font-bold tracking-widest text-red-700/70">NEBEZPEƒåN√Å Z√ìNA</div>
diff --git a/src/components/mascot/Starry3D.tsx b/src/components/mascot/Starry3D.tsx
new file mode 100644
index 0000000..cf344b1
--- /dev/null
+++ b/src/components/mascot/Starry3D.tsx
@@ -0,0 +1,75 @@
+import { useState, useEffect, Suspense } from 'react';
+import ReactSpline from '@splinetool/react-spline';
+
+const SPLINE_SCENE_URL = "PASTE_YOUR_SPLINE_URL_HERE";
+const STATIC_FALLBACK_IMG = "/assets/image.png"; // Using public path, assuming image is copied there or exists
+
+interface Starry3DProps {
+  className?: string;
+}
+
+export default function Starry3D({ className = "" }: Starry3DProps) {
+  const [is3DEnabled, setIs3DEnabled] = useState(false);
+  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);
+  const [isLoading, setIsLoading] = useState(true);
+  const [hasError, setHasError] = useState(false);
+
+  // Check user preference and system settings
+  useEffect(() => {
+    // 1. Check system reduced motion
+    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
+    setPrefersReducedMotion(mediaQuery.matches);
+    
+    const handler = (e: MediaQueryListEvent) => setPrefersReducedMotion(e.matches);
+    mediaQuery.addEventListener('change', handler);
+
+    // 2. Check localStorage setting
+    const storedSetting = localStorage.getItem('enable3DMascot');
+    setIs3DEnabled(storedSetting === 'true');
+
+    return () => mediaQuery.removeEventListener('change', handler);
+  }, []);
+
+  // Determine if we should show 3D
+  const shouldRender3D = is3DEnabled && !prefersReducedMotion && !hasError && SPLINE_SCENE_URL !== "PASTE_YOUR_SPLINE_URL_HERE";
+
+  return (
+    <div className={`relative ${className}`}>
+      {shouldRender3D ? (
+        <div className="w-full h-full relative">
+          {isLoading && (
+            <div className="absolute inset-0 flex flex-col items-center justify-center bg-transparent z-10">
+              <div className="w-8 h-8 rounded-full border-2 border-indigo-500 border-t-transparent animate-spin mb-2" />
+              <span className="text-xs text-indigo-500 font-medium">Naƒç√≠tavam Starry...</span>
+            </div>
+          )}
+          
+          <Suspense fallback={null}>
+            <ReactSpline 
+              scene={SPLINE_SCENE_URL}
+              onLoad={() => setIsLoading(false)}
+              onError={() => {
+                setHasError(true);
+                setIsLoading(false);
+              }}
+              style={{
+                width: '100%',
+                height: '100%',
+              }}
+            />
+          </Suspense>
+        </div>
+      ) : (
+        <img 
+          src={STATIC_FALLBACK_IMG} 
+          alt="Prof. StarLink" 
+          className="w-full h-full object-contain drop-shadow-xl"
+          onError={(e) => {
+            // Fallback if image fails - try relative path
+            (e.target as HTMLImageElement).src = new URL('../../assets/image.png', import.meta.url).href;
+          }}
+        />
+      )}
+    </div>
+  );
+}
diff --git a/src/routes/WelcomeScreen.tsx b/src/routes/WelcomeScreen.tsx
index 6ec36de..097b8dc 100644
--- a/src/routes/WelcomeScreen.tsx
+++ b/src/routes/WelcomeScreen.tsx
@@ -1,5 +1,6 @@
 import { useState, useEffect, useMemo } from 'react';
 import heroImg from '../assets/image.png';
+import Starry3D from '../components/mascot/Starry3D';
 
 // Floating particles config (limited for performance)
 const PARTICLES = [
@@ -123,12 +124,10 @@ export default function WelcomeScreen() {
           {/* Glow behind image */}
           <div className="absolute inset-[-20%] rounded-full bg-blue-500/20 blur-3xl animate-glow" />
           
-          {/* Hero Image */}
-          <img 
-            src={heroImg} 
-            alt="Starlink Heart" 
-            className="relative z-10 w-full h-full object-contain drop-shadow-2xl"
-          />
+          {/* Hero Image / 3D Mascot */}
+          <div className="relative w-full h-full z-10">
+            <Starry3D className="w-full h-full" />
+          </div>
         </div>
       </div>
 
-- 
2.50.1 (Apple Git-155)

